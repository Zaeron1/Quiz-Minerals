<!-- mode1.html – Nom → Formule (amélioré) -->
<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Nom → Formule</title>
  <style>
    :root{
      --primary:#4a90e2;
      --primary-dark:#357ab8;
      --success:#2ecc71;
      --error:#e74c3c;
    }
    body{
      margin:0;
      min-height:100vh;
      display:flex;
      align-items:center;
      justify-content:center;
      background:linear-gradient(135deg,#f5f7fa 0%,#c3cfe2 100%);
      font-family:'Segoe UI',Roboto,Arial,sans-serif;
    }
    .card{
      background:#fff;
      padding:2rem 2.5rem;
      border-radius:12px;
      box-shadow:0 8px 24px rgba(0,0,0,.1);
      width:min(480px,90%);
      text-align:center;
    }
    h2{margin-top:0}
    .prompt{font-size:1.8rem;margin-bottom:1rem;}
    input,select{
      font-size:1rem;
      padding:.4rem .6rem;
      border:1px solid #bbb;
      border-radius:6px;
      margin:.4rem;
      max-width:220px;
    }
    button.btn{
      background:var(--primary);
      color:#fff;
      border:none;
      border-radius:8px;
      padding:.6rem 1.4rem;
      font-size:1rem;
      margin:.4rem;
      cursor:pointer;
      transition:background .2s;
    }
    button.btn:hover{background:var(--primary-dark);}
    #message{font-size:1.4rem;margin-top:1rem;height:1.6rem;}
    .vrai{color:var(--success);}
    .faux{color:var(--error);}
    .fade{animation:fadeOut .8s forwards;}
    @keyframes fadeOut{from{opacity:1;}to{opacity:0;}}
    .hint{font-size:.9rem;color:var(--error);margin-left:.5rem;}
  </style>
</head>
<body>
  <div class="card">
    <h2>Nom → Formule</h2>

    <div id="question" class="prompt"></div>

    <input type="text" id="formula" placeholder="Entrez la formule">
    <span id="formulaHint" class="hint"></span>
    <br>

    <select id="system"></select>
    <span id="systemHint" class="hint"></span>
    <br>

    <button class="btn" onclick="checkAnswer()">Valider</button>
    <button class="btn" onclick="skip()">Passer</button>
    <button class="btn" onclick="showAnswer()">Réponse</button>

    <div id="message"></div>
  </div>

  <script>
  /* -------- utilitaires -------- */
  const systems = ["triclinique","monoclinique","orthorhombique",
                   "tétragonal","trigonal","hexagonal","cubique"];

  function formulaToHTML(f){return f.replace(/(\d+)/g,'<sub>$1</sub>');}
  function sanitizeFormula(f){return f.replace(/\s|_/g,'').toUpperCase();}
  const equalNoCase = (a,b)=>a.trim().toUpperCase()===b.trim().toUpperCase();

  function shuffle(arr){            /* Fisher-Yates */
    const a=arr.slice();
    for(let i=a.length-1;i>0;i--){
      const j=Math.floor(Math.random()*(i+1));
      [a[i],a[j]]=[a[j],a[i]];
    }
    return a;
  }

  /* -------- données -------- */
  const minerals=[
    {name:"Malachite", formula:"Cu3(CO3)2(OH)2", system:"monoclinique"},
    {name:"Quartz",    formula:"SiO2",           system:"trigonal"},
    {name:"Hématite",  formula:"Fe2O3",          system:"trigonal"},
    {name:"Galène",    formula:"PbS",            system:"cubique"},
    {name:"Calcite",   formula:"CaCO3",          system:"trigonal"}
  ];

  /* -------- variables globales -------- */
  let formulaInput,formulaHint,systemHint,messageDiv,questionDiv,systemSel;
  let order=[],idx=-1,current=null;

  /* -------- fonctions -------- */
  function prepareSelect(){
    systemSel=document.getElementById("system");
    systems.forEach(s=>{
      const o=document.createElement("option");
      o.value=o.textContent=s;
      systemSel.appendChild(o);
    });
  }

  function nextQuestion(){
    if(++idx>=order.length){ order=shuffle(minerals); idx=0; }
    current=order[idx];

    questionDiv.textContent=current.name;
    formulaInput.value="";
    systemSel.selectedIndex=0;
    resetHints();
    messageDiv.textContent="";
    messageDiv.className="";
  }

  function resetHints(){formulaHint.textContent="";systemHint.textContent="";}

  function showMessage(txt,cls){
    /* ré-initialise l’animation fade à chaque affichage */
    messageDiv.classList.remove("fade");
    void messageDiv.offsetWidth;                // force reflow
    messageDiv.textContent=txt;
    messageDiv.className=cls;
    if(cls==="faux") messageDiv.classList.add("fade");
  }

  function checkAnswer(){
    resetHints();
    let ok=true;

    if(!equalNoCase(sanitizeFormula(formulaInput.value),sanitizeFormula(current.formula))){
      ok=false;formulaHint.textContent="Faux";formulaInput.value="";
    }
    if(!equalNoCase(systemSel.value,current.system)){
      ok=false;systemHint.textContent="Faux";
    }

    if(ok){
      showMessage("Vrai !","vrai");
      setTimeout(nextQuestion,800);
    }else{
      showMessage("Faux !","faux");
    }
  }

  const skip = ()=>nextQuestion();
  function showAnswer(){
    formulaInput.value=current.formula;
    systemSel.value=current.system;
  }

  /* -------- init -------- */
  document.addEventListener("DOMContentLoaded",()=>{
    formulaInput=document.getElementById("formula");
    formulaHint=document.getElementById("formulaHint");
    systemHint=document.getElementById("systemHint");
    messageDiv=document.getElementById("message");
    questionDiv=document.getElementById("question");
    prepareSelect();
    nextQuestion();
  });
  </script>
</body>
</html>